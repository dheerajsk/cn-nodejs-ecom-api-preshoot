<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Socket.io Chat</title>

    <style>
        /* Style for the text box */
        input[type="text"] {
            width: 70%;
            padding: 10px 15px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        /* Style for the button */
        button {
            padding: 10px 15px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        .message {
            padding: 5px;
            border-bottom: 1px solid #ccc;
        }

        .message:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>


<body>

    <!-- Adding chat UI -->
    <div id="chat-container">
        <div id="message-list"></div>
        <input type="text" id="message-input" placeholder="Type your message...">
        <button id="send-button">Send</button>
    </div>

    <!-- The existing Socket.io connection code -->
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script>
        const userName = prompt("Please enter your name:");
        const socket = io.connect('http://localhost:3000');

        socket.on('connect', () => {
            socket.emit('join', userName);
        });

        // Here weâ€™ll add the event listeners for our chat interface

        const messageInput = document.getElementById("message-input");
        const messageList = document.getElementById("message-list");
        const sendButton = document.getElementById("send-button");

        sendButton.addEventListener('click', function () {
            const message = messageInput.value;
            if (message) {
                socket.emit('new_message', message); // Emitting the message to the server

                // Append the message to our chat
                const messageElem = document.createElement("div");
                messageElem.className = 'message';
                messageElem.innerHTML = `<strong>${userName}</strong>: ${message}`;
                messageList.appendChild(messageElem);

                // Clear the input
                messageInput.value = '';
            }
        });

        socket.on('load_previous_messages', (messages) => {
            console.log(messages)
            messages.forEach(message => {
                displayMessage(message);
            });
        });

        // Listen for new messages from the server
        socket.on('broadcast_message', function (data) {
            console.log(data)
            const msgElement = document.createElement('div');
            msgElement.className = 'message';
            msgElement.innerHTML = `<strong>${data.userName}</strong>: ${data.message}`;
            messageList.appendChild(msgElement);
        });

        function displayMessage(message) {
            let time = new Date(message.timestamp);
            let formattedTime = formatDate(time);
            const msgElement = document.createElement('div');
            msgElement.className = 'message';
            msgElement.innerHTML += `<div><strong>${message.username} ${formattedTime}:</strong> ${message.message}</div>`;
            messageList.appendChild(msgElement);
        }

        function formatDate(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1; // JavaScript month starts from 0
            const year = date.getFullYear();

            let hours = date.getHours();
            let minutes = date.getMinutes();
            const meridiem = hours >= 12 ? 'PM' : 'AM';

            // Convert to 12-hour format
            hours = hours % 12;
            hours = hours ? hours : 12; // if 0, then it's 12

            minutes = minutes < 10 ? '0' + minutes : minutes; // Add leading 0 to minutes if less than 10

            return `${day}/${month}/${year} ${hours}:${minutes} ${meridiem}`;
        }

    </script>
</body>

</html>